{% load tz %}
{% load staticfiles %}

<script type="text/javascript" >
    function defaultAddress(pThis,id)
    {
        console.log('+defaultAddress');
    }

    function editAddress(pThis,id)
    {
        console.log('+editAddress');
    }

    function deleteAddress(pThis,id)
    {
        console.log('+deleteAddress');
        data = get_csrf();
        data['A_id'] = id;
        postRequest('/locus/address/delete/', data, function(status, resp){
            console.log(resp);
            if (status) {
                $(pThis).parents(".addr_item").remove();
            } else {
                Noti.error({title:resp.message, text:JSON.stringify(resp.data)});
            }
        });
    }

    function showAddressBox(e, pThis) {
        console.log("+showAddressBox");
        e.stopPropagation();

        var modal = $('#wt-overlay');
        var ap = $('#address_picker');
        modal.find('.wt-overlay-content').append(ap.show());
        modal.show();
        updateMap();
        modal.find('.wt-closebtn').on('click',
            function() {
                console.log('CLOSE');
                ap.detach().hide();
                modal.hide();
                setTimeout(function(){ ap.appendTo('body'); }, 300);
            }
        );
        console.log("-showAddressBox");
    }

    function hideAddressBox()
    {
        console.log('+hideAddressBox');
        $('.wt-closebtn').click();
    }

    function beforeAdSaveReq(e) {
    	console.log("+beforeAdSaveReq");
    	return true;
    }

    function afterAdSaveRes(e) {
    	console.log("+afterAdSaveRes");
    	if (e.status) {
    		var val = e.resp;
    		$('#address_cont').prepend(val);
            hideAddressBox();
    	} else {
    		var errors = '';
    		for (var err in e.resp.data) {
    			errors += e.resp.data[err] + '<br />';
    		}
    		Noti.info({title:e.resp.message, text:errors});
    	}
        return true;
    }

    $(function(){
    	AddressSaveEvent(beforeAdSaveReq, afterAdSaveRes);
    });
</script>

<div class="ui-content" style="height: 1000px;">
	<div class="ui-block" >
		<div class="ui-block-bar">
			<div>
				<h3>ADDRESS</h3>
			</div>
			<div>
			</div>
		</div>
		<div class="ui-block-body">
			<a onclick="showAddressBox(event, this);" class="ui-btn-a" >New Address</a>
		</div>
	</div>
    <div id="address_cont" >
        {% for address in addresses %}
            {% include './address_item_1.html' %}
        {% endfor %}
    </div>
</div>

{% include './address_picker_1.html' %}
